<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Write Your Journey | Voyago</title>
    <link rel="stylesheet" href="addnewtrips.css" />
  </head>
  <body>
    <!-- INTRO -->
    <section class="intro">
      <h1>Write This Before You Forget It</h1>
      <p>No filters. No grammar rules. Just you, your memory, and this page.</p>
    </section>

    <!-- JOURNAL -->
    <main class="journal-wrapper">
      <div class="journal-card">
        <div class="prompt">‚úçÔ∏è <span>Give this memory a name</span></div>
        <input type="text" id="title" placeholder="A rainy evening in Paris‚Ä¶" />

        <div class="prompt">üìç <span>Where were you?</span></div>
        <input
          type="text"
          id="location"
          placeholder="City, country, or just a place that mattered"
        />

        <div class="prompt">üóìÔ∏è <span>When did this happen?</span></div>
        <input type="date" id="date" />

        <div class="prompt big">
          üìñ <span>Now tell the story</span>
          <small>
            Start anywhere. What surprised you? What did you feel? What do you
            still remember clearly?
          </small>
        </div>

        <textarea
          id="story"
          rows="10"
          placeholder="I still remember the moment when‚Ä¶"
        ></textarea>

        <!-- VOICE -->
        <div class="voice-block">
          <p>üéôÔ∏è Too much to type? Say it out loud.</p>
          <div class="voice-buttons">
            <button type="button" onclick="startRecording()">
              Start Recording
            </button>
            <button type="button" onclick="stopRecording()">Stop</button>
          </div>
          <audio id="audioPreview" controls></audio>
        </div>

        <button class="save-btn" onclick="saveTrip()">Save This Memory</button>
      </div>
    </main>

    <script>
      let mediaRecorder;
      let audioChunks = [];
      let audioBase64 = "";

      function startRecording() {
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          audioChunks = [];
          mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
        });
      }

      function stopRecording() {
        if (!mediaRecorder) return;
        mediaRecorder.stop();
        mediaRecorder.onstop = () => {
          const blob = new Blob(audioChunks, { type: "audio/webm" });
          const reader = new FileReader();
          reader.onloadend = () => {
            audioBase64 = reader.result;
            const audio = document.getElementById("audioPreview");
            audio.src = audioBase64;
            audio.style.display = "block";
          };
          reader.readAsDataURL(blob);
        };
      }

      function saveTrip() {
        const title = document.getElementById("title").value;
        const location = document.getElementById("location").value;
        const date = document.getElementById("date").value;
        const story = document.getElementById("story").value;

        if (!title || !location || !date || !story) {
          alert("Don‚Äôt rush. Fill it like a memory, not a form.");
          return;
        }

        const trip = {
          title,
          location,
          date,
          story,
          voiceNote: audioBase64,
        };

        let trips = JSON.parse(localStorage.getItem("trips")) || [];
        trips.push(trip);
        localStorage.setItem("trips", JSON.stringify(trips));

        window.location.href = "Myjournal.html";
      }
    </script>
  </body>
</html>
